<%= javascript_include_tag 'status_handler.js' %>

<br>

<div class="row">
  <div class='col-md-2'>
    <%= link_to image_tag(@event.logo_url, alt: 'Akshat', class: 'img-responsive'), event_path(@event) %>
  </div>
  <div class='col-md-5 col-md-offset-1'>
    <div class='row'>
      <div class='row'>
        <h3><%= @event.name.capitalize %></h3>
      </div>
      <br>
      <div class='row'>
        <div class='col-md-6'>
          <%= get_duration_string(@event.start_time, @event.end_time) %>
        </div>
        <div class='col-md-6'>
          <%= @event.address.city + ', ' + @event.address.country %>
        </div>
      </div>
      <br>
      <div class='row'>
        <%= strip_tags(@event.description) %>
      </div>
    </div>
  </div>
  <div class='col-md-2'>
    <h4><%= get_event_status(@event) %></h4>
  </div>
  <div class="col-md-1">
    <% if @event.upcoming? %>
      <% if event_enabled?(@event) %>
        <%= link_to ' Disable',  disable_admin_event_path(@event), class: 'btn btn-primary toggle', method: :put, data: { confirm: "Are you sure?", type: :json,  remote: true } %>
      <% else %>
        <%= link_to 'Enable ',enable_admin_event_path(@event, random: 'rnadom'), class: 'btn btn-success toggle', method: :put, data: { confirm: "Are you sure?", type: :json,  remote: true } %>
      <% end %>
    <% else %>
      <%= event_enabled?(@event) ? 'Enabled' : 'Disabled' %> (Past)
    <% end %>
  </div>
</div>


<h3> Discussions </h3>
<hr>

<% if @discussions.empty? %>
  No discussions exist
<% else %>
  <table class="table table-striped">
    <thead>
      <tr>
        <th class="col-md-4">
          Name
        </th>
        <th class="col-md-1">
          Creator
        </th>
        <th class="col-md-1">
          Date
        </th>
        <th class="col-md-1">
          Start Time
        </th>
        <th class="col-md-1">
          End Time
        </th>
        <th class="col-md-1">
          Location
        </th>
        <th class="col-md-1">
          Speaker
        </th>
        <th class="col-md-2">
          Status
        </th>
      </tr>
    </thead>

    <!-- # [DOUBT TODO - S] How many queries are being fired here?? -->
    <!-- only one query for discussions is being fired -->
    <% @discussions.each do |discussion| %>
      <tr>
        <td class="col-md-1">
          <div class="row">
            <strong><%= discussion.name + ' - ' + discussion.topic %></strong>
          </div>
          <div class="row">
            <%= discussion.description %>
          </div>
        </td>
        <td class="col-md-1">
          <%= discussion.creator.title + ' ' + discussion.creator.name %>
        </td>
        <td class="col-md-1">
          <%= discussion.date %>
        </td>
        <td class="col-md-1">
          <%= discussion.start_time.to_s(:time) %>
        </td>
        <td class="col-md-1">
          <%= discussion.end_time.to_s(:time) %>
        </td>
        <td class="col-md-1">
          <%= discussion.location %>
        </td>
        <td class="col-md-1">
          <%= discussion.speaker.title + ' ' +  discussion.speaker.name %>
        </td>
        <td class="col-md-1">
          <% if discussion.upcoming? %>
            <!-- # [DONE TODO - S] Make all enable / disable actions as ajax actions. -->
            <% if discussion.enabled? %>
              <%= link_to "DISABLE", disable_admin_event_discussion_path(@event, discussion), method: :put, data: {remote: true, confirm: 'Are you sure?', type: 'json'}, class: 'btn btn-primary toggle' %>
            <% else %>
              <%= link_to "ENABLE", enable_admin_event_discussion_path(@event, discussion), method: :put, data: {remote: true, confirm: 'Are you sure?', type: 'json'}, class: 'btn btn-success toggle' %>
            <% end %>
          <% else %>
            <%= discussion.enabled? ? 'Enabled' : 'Disabled' %> (Past)
          <% end %>
        </td>
      </tr>
    <% end %>
  </table>
<% end %>
